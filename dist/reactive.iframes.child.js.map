{"version":3,"sources":["reactive.iframes.child.ts"],"names":["reactive","reactive.iframes","reactive.iframes.Child","reactive.iframes.Child.constructor","reactive.iframes.Child.processMessage","reactive.iframes.Child.sendMessage","reactive.iframes.Child.makeMessage","reactive.iframes.Child.currentHeight"],"mappings":"AACA,IAAO,QAAQ,CAoEd;AApED,WAAO,QAAQ;IAACA,IAAAA,OAAOA,CAoEtBA;IApEeA,WAAAA,OAAOA,EAACA,CAACA;QAErBC,IAAMA,aAAaA,GAAGA,iBAAiBA,CAACA;QACxCA,IAAMA,gBAAgBA,GAAGA,GAAGA,CAACA;QAC7BA,IAAMA,oBAAoBA,GAAGA,cAAcA,CAACA;QAC5CA,IAAMA,aAAaA,GAAGA,qBAAqBA,CAACA;QAE5CA;YAKIC;gBACIC,IAAIA,SAASA,GAAGA,QAAQA,CAACA,cAAcA,CAACA,aAAaA,CAACA,CAACA;gBACvDA,EAAEA,CAACA,CAACA,CAACA,SAASA,CAACA;oBACXA,MAAMA,IAAIA,KAAKA,CAACA,sDAAsDA,GAAGA,aAAaA,GAAIA,wCAAwCA,CAACA,CAACA;gBAExIA,EAAEA,CAACA,CAACA,CAACA,SAASA,CAACA,YAAYA,CAACA,oBAAoBA,CAACA,CAACA;oBAC9CA,MAAMA,IAAIA,KAAKA,CAACA,qEAAqEA,GAAGA,oBAAoBA,GAAGA,wCAAwCA,CAACA,CAACA;gBAG7JA,IAAIA,CAACA,EAAEA,GAAGA,SAASA,CAACA,YAAYA,CAACA,cAAcA,CAACA,CAACA;gBAEjDA,IAAIA,CAACA,YAAYA,GAAGA,IAAIA,MAAMA,CAACA,GAAGA,GAAGA,aAAaA,GAAGA,gBAAgBA,GAAGA,IAAIA,CAACA,EAAEA,GAAGA,gBAAgBA,GAAGA,QAAQA,GAAGA,gBAAgBA,GAAGA,OAAOA,CAACA,CAACA;gBAE5IA,MAAMA,CAACA,gBAAgBA,CAACA,SAASA,EAAEA,IAAIA,CAACA,cAAcA,CAACA,IAAIA,CAACA,IAAIA,CAACA,EAAEA,KAAKA,CAACA,CAACA;gBAE1EA,IAAIA,CAACA,WAAWA,GAAGA,IAAIA,CAACA;gBACxBA,IAAIA,CAACA,WAAWA,CAACA,QAAQA,EAAEA,IAAIA,CAACA,aAAaA,CAACA,CAACA;YACnDA,CAACA;YAEDD,8BAAcA,GAAdA,UAAeA,KAAYA;gBAEvBE,EAAEA,CAACA,CAACA,CAACA,CAACA,KAAKA,YAAYA,YAAYA,CAACA,IAAIA,OAAqBA,KAAKA,CAACA,IAAIA,KAAKA,QAAQA,CAACA,CAACA,CAACA;oBACnFA,MAAMA,CAACA;gBACXA,CAACA;gBACDA,IAAIA,WAAWA,GAA0BA,KAAMA,CAACA,IAAIA,CAACA;gBAErDA,IAAIA,KAAKA,GAAGA,WAAWA,CAACA,KAAKA,CAACA,IAAIA,CAACA,YAAYA,CAACA,CAACA;gBAEjDA,EAAEA,CAACA,CAACA,CAACA,KAAKA,IAAIA,KAAKA,CAACA,MAAMA,KAAKA,CAACA,CAACA,CAACA,CAACA;oBAACA,MAAMA,CAACA;gBAACA,CAACA;gBAE7CA,IAAIA,GAAGA,GAAGA,KAAKA,CAACA,CAACA,CAACA,CAACA;gBACnBA,IAAIA,KAAKA,GAAGA,KAAKA,CAACA,CAACA,CAACA,CAACA;gBACrBA,EAAEA,CAACA,CAACA,GAAGA,KAAKA,OAAOA,CAACA,CAACA,CAACA;oBAClBA,IAAIA,KAAKA,GAAGA,QAAQA,CAACA,KAAKA,CAACA,CAACA;oBAC5BA,OAAOA,CAACA,GAAGA,CAACA,YAAYA,GAAGA,KAAKA,GAAGA,YAAYA,GAAGA,IAAIA,CAACA,EAAEA,GAAGA,GAAGA,CAACA,CAACA;oBAEjEA,EAAEA,CAACA,CAACA,KAAKA,KAAKA,IAAIA,CAACA,WAAWA,CAACA,CAACA,CAACA;wBAC7BA,IAAIA,CAACA,WAAWA,GAAGA,KAAKA,CAACA;wBACzBA,IAAIA,CAACA,WAAWA,CAACA,QAAQA,EAAEA,IAAIA,CAACA,aAAaA,CAACA,CAACA;oBACnDA,CAACA;gBACLA,CAACA;YACLA,CAACA;YAEDF,2BAAWA,GAAXA,UAAYA,WAAmBA,EAAEA,OAAeA;gBAC5CG,MAAMA,CAACA,MAAMA,CAACA,WAAWA,CAACA,IAAIA,CAACA,WAAWA,CAACA,WAAWA,EAAEA,OAAOA,CAACA,EAAEA,GAAGA,CAACA,CAACA;YAC3EA,CAACA;YAEOH,2BAAWA,GAAnBA,UAAoBA,WAAmBA,EAAEA,OAAeA;gBACpDI,IAAIA,IAAIA,GAAGA,CAACA,aAAaA,EAAEA,IAAIA,CAACA,EAAEA,EAAEA,WAAWA,EAAEA,OAAOA,CAACA,CAACA;gBAC1DA,MAAMA,CAACA,IAAIA,CAACA,IAAIA,CAACA,gBAAgBA,CAACA,CAACA;YACvCA,CAACA;YAEDJ,sBAAIA,gCAAaA;qBAAjBA;oBACIK,MAAMA,CAACA,QAAQA,CAACA,IAAIA,CAACA,YAAYA,CAACA,QAAQA,EAAEA,CAACA;gBACjDA,CAACA;;;eAAAL;YACLA,YAACA;QAADA,CA5DAD,AA4DCC,IAAAD;QA5DYA,aAAKA,QA4DjBA,CAAAA;IACLA,CAACA,EApEeD,OAAOA,GAAPA,gBAAOA,KAAPA,gBAAOA,QAoEtBA;AAADA,CAACA,EApEM,QAAQ,KAAR,QAAQ,QAoEd;AAED,CAAC;IACG,IAAI,aAAa,GAAG,MAAM,CAAC,MAAM,CAAC;IAClC,EAAE,CAAC,CAAC,QAAQ,CAAC,UAAU,KAAK,UAAU,CAAC,CAAC,CAAC;QACrC,IAAI,QAAQ,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;IACjC,CAAC;IAAC,IAAI,CAAC,CAAC;QACJ,MAAM,CAAC,MAAM,GAAG,UAAU,CAAQ;YAC9B,IAAI,QAAQ,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;YAC7B,EAAE,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC;gBAChB,aAAa,CAAC,CAAC,CAAC,CAAC;YACrB,CAAC;QACL,CAAC,CAAC;IACN,CAAC;AACL,CAAC,CAAC,EAAE,CAAC","file":"reactive.iframes.child.js","sourcesContent":["\r\nmodule reactive.iframes {\r\n\r\n    const MessagePrefix = 'ReactiveIFrames';\r\n    const MessageDelimiter = '~';\r\n    const FrameIdAttributeName = 'data-frameid';\r\n    const FrameScriptId = 'iframe_child_script';\r\n\r\n    export class Child {\r\n        messageRegex : RegExp\r\n        id: string\r\n        parentWidth: number\r\n\r\n        constructor() {\r\n            var scriptTag = document.getElementById(FrameScriptId);\r\n            if (!scriptTag)\r\n                throw new Error('The ReactiveIFrames child script requires an id of \"' + FrameScriptId  + '\" on the <script> tag that included it');\r\n\r\n            if (!scriptTag.hasAttribute(FrameIdAttributeName))\r\n                throw new Error('The ReactiveIFrames child script requires a data attribute called \"' + FrameIdAttributeName + '\" on the <script> tag that included it');\r\n\r\n\r\n            this.id = scriptTag.getAttribute('data-frameid');\r\n\r\n            this.messageRegex = new RegExp('^' + MessagePrefix + MessageDelimiter + this.id + MessageDelimiter + '(\\\\S+)' + MessageDelimiter + '(.+)$');\r\n\r\n            window.addEventListener('message', this.processMessage.bind(this), false);\r\n            \r\n            this.parentWidth = null;\r\n            this.sendMessage('height', this.currentHeight);\r\n        }\r\n\r\n        processMessage(event: Event) {\r\n            \r\n            if (!(event instanceof MessageEvent) || typeof <MessageEvent>event.data !== 'string') {\r\n                return;\r\n            }\r\n            var messageData = <string>(<MessageEvent>event).data;\r\n\r\n            var match = messageData.match(this.messageRegex);\r\n\r\n            if (!match || match.length !== 3) { return; }\r\n\r\n            var key = match[1];\r\n            var value = match[2];\r\n            if (key === 'width') {\r\n                var width = parseInt(value);\r\n                console.log(\"Parent -> \" + width + \" W Child (\" + this.id + \")\");\r\n                // Change the width if it's different.\r\n                if (width !== this.parentWidth) {\r\n                    this.parentWidth = width;\r\n                    this.sendMessage('height', this.currentHeight);\r\n                }\r\n            }\r\n        }\r\n\r\n        sendMessage(messageType: string, message: string) {\r\n            window.parent.postMessage(this.makeMessage(messageType, message), '*');\r\n        }\r\n\r\n        private makeMessage(messageType: string, message: string) {\r\n            var bits = [MessagePrefix, this.id, messageType, message];\r\n            return bits.join(MessageDelimiter);\r\n        }   \r\n        \r\n        get currentHeight() : string {\r\n            return document.body.offsetHeight.toString();\r\n        }\r\n    }\r\n}\r\n\r\n(function () {\r\n    var oldWindowLoad = window.onload;\r\n    if (document.readyState === \"complete\") {\r\n        new reactive.iframes.Child();\r\n    } else {\r\n        window.onload = function (e: Event) {\r\n            new reactive.iframes.Child();\r\n            if (oldWindowLoad) {\r\n                oldWindowLoad(e);\r\n            }\r\n        };\r\n    }\r\n})();"],"sourceRoot":"/source/"}